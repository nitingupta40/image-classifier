{"ast":null,"code":"var _jsxFileName = \"/Users/thesavages/projects/image-classifier/src/App.js\";\nimport React, { useReducer, useState, useRef } from \"react\";\nimport * as mobilenet from \"@tensorflow-models/mobilenet\";\nimport \"./App.css\";\nconst stateMachine = {\n  initial: \"initial\",\n  states: {\n    initial: {\n      on: {\n        next: \"loadingModel\",\n        text: \"Load Model\"\n      }\n    },\n    loadingModel: {\n      on: {\n        next: \"modelReady\",\n        text: \"Loading Model\"\n      }\n    },\n    modelReady: {\n      on: {\n        next: \"imageReady\",\n        text: \"Upload Image\"\n      }\n    },\n    imageReady: {\n      on: {\n        next: \"identifying\",\n        text: \"Identifying Image\",\n        showImage: true\n      }\n    },\n    identifying: {\n      on: {\n        next: \"complete\",\n        text: \"Identifying...\"\n      }\n    },\n    complete: {\n      on: {\n        next: \"modelReady\",\n        text: \"Load Reset\",\n        showImage: true,\n        showResult: true\n      }\n    }\n  }\n};\n\nconst reducer = (currentState, event) => stateMachine.states[currentState].on[event] || stateMachine.initial;\n\nconst App = () => {\n  const [appState, dispatch] = useReducer(reducer, stateMachine.initial);\n  const [model, setModel] = useState(null);\n  const [imageUrl, setImageUrl] = useState(null);\n  const [results, setResults] = useState([]);\n  const inputRef = useRef();\n  const imageRef = useRef();\n  const {\n    showImage = false,\n    showResults = false\n  } = stateMachine.states[appState];\n\n  const next = () => dispatch(\"next\");\n\n  const load = async () => {\n    next(); //const mobilenetModel = await mobilenet.load();\n\n    setModel(mobilenetModel);\n    next();\n  };\n\n  const handleUpload = event => {\n    const {\n      files\n    } = event.target;\n\n    if (files.length > 0) {\n      const url = URL.createObjectURL(files[0]);\n      setImageUrl(url);\n      next();\n    }\n  };\n\n  const identify = async () => {\n    next(); //const results = await model.classify(imageRef.current);\n    //setResults(results);\n\n    next();\n  };\n\n  const formatResult = ({\n    className,\n    probability\n  }) => /*#__PURE__*/React.createElement(\"li\", {\n    key: className,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 5\n    }\n  }, `${className}: %${(probability * 100).toFixed(2)}`);\n\n  const reset = () => {\n    setResults([]);\n    setImageUrl(null);\n    next();\n  };\n\n  const buttonProps = {\n    initial: {\n      text: \"Load Model\",\n      action: load\n    },\n    loadingModel: {\n      text: \"Loading Model…\",\n      action: () => {}\n    },\n    modelReady: {\n      text: \"Upload Image\",\n      action: () => inputRef.current.click()\n    },\n    imageReady: {\n      text: \"Identify Image\",\n      action: () => identify\n    },\n    identifying: {\n      text: \"Identifying…\",\n      action: () => {}\n    },\n    complete: {\n      text: \"Reset\",\n      action: reset\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, showImage && /*#__PURE__*/React.createElement(\"img\", {\n    src: imageUrl,\n    alt: \"upload-preview\",\n    ref: imageRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    accept: \"image/*\",\n    capture: \"camera\",\n    ref: inputRef,\n    onChange: handleUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: buttonProps[appState].action,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }, buttonProps[appState].text), showResults && /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 23\n    }\n  }, results.map(formatResult)));\n};\n\nexport default App;","map":{"version":3,"sources":["/Users/thesavages/projects/image-classifier/src/App.js"],"names":["React","useReducer","useState","useRef","mobilenet","stateMachine","initial","states","on","next","text","loadingModel","modelReady","imageReady","showImage","identifying","complete","showResult","reducer","currentState","event","App","appState","dispatch","model","setModel","imageUrl","setImageUrl","results","setResults","inputRef","imageRef","showResults","load","mobilenetModel","handleUpload","files","target","length","url","URL","createObjectURL","identify","formatResult","className","probability","toFixed","reset","buttonProps","action","current","click","map"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,QAA5B,EAAsCC,MAAtC,QAAoD,OAApD;AACA,OAAO,KAAKC,SAAZ,MAA2B,8BAA3B;AACA,OAAO,WAAP;AAEA,MAAMC,YAAY,GAAG;AACnBC,EAAAA,OAAO,EAAE,SADU;AAEnBC,EAAAA,MAAM,EAAE;AACND,IAAAA,OAAO,EAAE;AAAEE,MAAAA,EAAE,EAAE;AAAEC,QAAAA,IAAI,EAAE,cAAR;AAAwBC,QAAAA,IAAI,EAAE;AAA9B;AAAN,KADH;AAENC,IAAAA,YAAY,EAAE;AAAEH,MAAAA,EAAE,EAAE;AAAEC,QAAAA,IAAI,EAAE,YAAR;AAAsBC,QAAAA,IAAI,EAAE;AAA5B;AAAN,KAFR;AAGNE,IAAAA,UAAU,EAAE;AAAEJ,MAAAA,EAAE,EAAE;AAAEC,QAAAA,IAAI,EAAE,YAAR;AAAsBC,QAAAA,IAAI,EAAE;AAA5B;AAAN,KAHN;AAING,IAAAA,UAAU,EAAE;AACVL,MAAAA,EAAE,EAAE;AAAEC,QAAAA,IAAI,EAAE,aAAR;AAAuBC,QAAAA,IAAI,EAAE,mBAA7B;AAAkDI,QAAAA,SAAS,EAAE;AAA7D;AADM,KAJN;AAONC,IAAAA,WAAW,EAAE;AAAEP,MAAAA,EAAE,EAAE;AAAEC,QAAAA,IAAI,EAAE,UAAR;AAAoBC,QAAAA,IAAI,EAAE;AAA1B;AAAN,KAPP;AAQNM,IAAAA,QAAQ,EAAE;AACRR,MAAAA,EAAE,EAAE;AACFC,QAAAA,IAAI,EAAE,YADJ;AAEFC,QAAAA,IAAI,EAAE,YAFJ;AAGFI,QAAAA,SAAS,EAAE,IAHT;AAIFG,QAAAA,UAAU,EAAE;AAJV;AADI;AARJ;AAFW,CAArB;;AAqBA,MAAMC,OAAO,GAAG,CAACC,YAAD,EAAeC,KAAf,KACdf,YAAY,CAACE,MAAb,CAAoBY,YAApB,EAAkCX,EAAlC,CAAqCY,KAArC,KAA+Cf,YAAY,CAACC,OAD9D;;AAGA,MAAMe,GAAG,GAAG,MAAM;AAChB,QAAM,CAACC,QAAD,EAAWC,QAAX,IAAuBtB,UAAU,CAACiB,OAAD,EAAUb,YAAY,CAACC,OAAvB,CAAvC;AACA,QAAM,CAACkB,KAAD,EAAQC,QAAR,IAAoBvB,QAAQ,CAAC,IAAD,CAAlC;AACA,QAAM,CAACwB,QAAD,EAAWC,WAAX,IAA0BzB,QAAQ,CAAC,IAAD,CAAxC;AACA,QAAM,CAAC0B,OAAD,EAAUC,UAAV,IAAwB3B,QAAQ,CAAC,EAAD,CAAtC;AACA,QAAM4B,QAAQ,GAAG3B,MAAM,EAAvB;AACA,QAAM4B,QAAQ,GAAG5B,MAAM,EAAvB;AACA,QAAM;AAAEW,IAAAA,SAAS,GAAG,KAAd;AAAqBkB,IAAAA,WAAW,GAAG;AAAnC,MAA6C3B,YAAY,CAACE,MAAb,CACjDe,QADiD,CAAnD;;AAIA,QAAMb,IAAI,GAAG,MAAMc,QAAQ,CAAC,MAAD,CAA3B;;AAEA,QAAMU,IAAI,GAAG,YAAY;AACvBxB,IAAAA,IAAI,GADmB,CAEvB;;AACAgB,IAAAA,QAAQ,CAACS,cAAD,CAAR;AACAzB,IAAAA,IAAI;AACL,GALD;;AAOA,QAAM0B,YAAY,GAAGf,KAAK,IAAI;AAC5B,UAAM;AAAEgB,MAAAA;AAAF,QAAYhB,KAAK,CAACiB,MAAxB;;AACA,QAAID,KAAK,CAACE,MAAN,GAAe,CAAnB,EAAsB;AACpB,YAAMC,GAAG,GAAGC,GAAG,CAACC,eAAJ,CAAoBL,KAAK,CAAC,CAAD,CAAzB,CAAZ;AACAT,MAAAA,WAAW,CAACY,GAAD,CAAX;AACA9B,MAAAA,IAAI;AACL;AACF,GAPD;;AASA,QAAMiC,QAAQ,GAAG,YAAY;AAC3BjC,IAAAA,IAAI,GADuB,CAE3B;AACA;;AACAA,IAAAA,IAAI;AACL,GALD;;AAMA,QAAMkC,YAAY,GAAG,CAAC;AAAEC,IAAAA,SAAF;AAAaC,IAAAA;AAAb,GAAD,kBACnB;AAAI,IAAA,GAAG,EAAED,SAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,GAAEA,SAAU,MAAK,CAACC,WAAW,GAAG,GAAf,EAAoBC,OAApB,CAA4B,CAA5B,CAA+B,EADpD,CADF;;AAKA,QAAMC,KAAK,GAAG,MAAM;AAClBlB,IAAAA,UAAU,CAAC,EAAD,CAAV;AACAF,IAAAA,WAAW,CAAC,IAAD,CAAX;AACAlB,IAAAA,IAAI;AACL,GAJD;;AAMA,QAAMuC,WAAW,GAAG;AAClB1C,IAAAA,OAAO,EAAE;AAAEI,MAAAA,IAAI,EAAE,YAAR;AAAsBuC,MAAAA,MAAM,EAAEhB;AAA9B,KADS;AAElBtB,IAAAA,YAAY,EAAE;AAAED,MAAAA,IAAI,EAAE,gBAAR;AAA0BuC,MAAAA,MAAM,EAAE,MAAM,CAAE;AAA1C,KAFI;AAGlBrC,IAAAA,UAAU,EAAE;AACVF,MAAAA,IAAI,EAAE,cADI;AAEVuC,MAAAA,MAAM,EAAE,MAAMnB,QAAQ,CAACoB,OAAT,CAAiBC,KAAjB;AAFJ,KAHM;AAOlBtC,IAAAA,UAAU,EAAE;AAAEH,MAAAA,IAAI,EAAE,gBAAR;AAA0BuC,MAAAA,MAAM,EAAE,MAAMP;AAAxC,KAPM;AAQlB3B,IAAAA,WAAW,EAAE;AAAEL,MAAAA,IAAI,EAAE,cAAR;AAAwBuC,MAAAA,MAAM,EAAE,MAAM,CAAE;AAAxC,KARK;AASlBjC,IAAAA,QAAQ,EAAE;AAAEN,MAAAA,IAAI,EAAE,OAAR;AAAiBuC,MAAAA,MAAM,EAAEF;AAAzB;AATQ,GAApB;AAYA,sBACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGjC,SAAS,iBAAI;AAAK,IAAA,GAAG,EAAEY,QAAV;AAAoB,IAAA,GAAG,EAAC,gBAAxB;AAAyC,IAAA,GAAG,EAAEK,QAA9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADhB,eAEE;AACE,IAAA,IAAI,EAAC,MADP;AAEE,IAAA,MAAM,EAAC,SAFT;AAGE,IAAA,OAAO,EAAC,QAHV;AAIE,IAAA,GAAG,EAAED,QAJP;AAKE,IAAA,QAAQ,EAAEK,YALZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFF,eASE;AAAQ,IAAA,OAAO,EAAEa,WAAW,CAAC1B,QAAD,CAAX,CAAsB2B,MAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGD,WAAW,CAAC1B,QAAD,CAAX,CAAsBZ,IADzB,CATF,EAYGsB,WAAW,iBAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAKJ,OAAO,CAACwB,GAAR,CAAYT,YAAZ,CAAL,CAZlB,CADF;AAgBD,CA1ED;;AA4EA,eAAetB,GAAf","sourcesContent":["import React, { useReducer, useState, useRef } from \"react\";\nimport * as mobilenet from \"@tensorflow-models/mobilenet\";\nimport \"./App.css\";\n\nconst stateMachine = {\n  initial: \"initial\",\n  states: {\n    initial: { on: { next: \"loadingModel\", text: \"Load Model\" } },\n    loadingModel: { on: { next: \"modelReady\", text: \"Loading Model\" } },\n    modelReady: { on: { next: \"imageReady\", text: \"Upload Image\" } },\n    imageReady: {\n      on: { next: \"identifying\", text: \"Identifying Image\", showImage: true }\n    },\n    identifying: { on: { next: \"complete\", text: \"Identifying...\" } },\n    complete: {\n      on: {\n        next: \"modelReady\",\n        text: \"Load Reset\",\n        showImage: true,\n        showResult: true\n      }\n    }\n  }\n};\n\nconst reducer = (currentState, event) =>\n  stateMachine.states[currentState].on[event] || stateMachine.initial;\n\nconst App = () => {\n  const [appState, dispatch] = useReducer(reducer, stateMachine.initial);\n  const [model, setModel] = useState(null);\n  const [imageUrl, setImageUrl] = useState(null);\n  const [results, setResults] = useState([]);\n  const inputRef = useRef();\n  const imageRef = useRef();\n  const { showImage = false, showResults = false } = stateMachine.states[\n    appState\n  ];\n\n  const next = () => dispatch(\"next\");\n\n  const load = async () => {\n    next();\n    //const mobilenetModel = await mobilenet.load();\n    setModel(mobilenetModel);\n    next();\n  };\n\n  const handleUpload = event => {\n    const { files } = event.target;\n    if (files.length > 0) {\n      const url = URL.createObjectURL(files[0]);\n      setImageUrl(url);\n      next();\n    }\n  };\n\n  const identify = async () => {\n    next();\n    //const results = await model.classify(imageRef.current);\n    //setResults(results);\n    next();\n  };\n  const formatResult = ({ className, probability }) => (\n    <li key={className}>\n      {`${className}: %${(probability * 100).toFixed(2)}`}\n    </li>\n  );\n  const reset = () => {\n    setResults([]);\n    setImageUrl(null);\n    next();\n  };\n\n  const buttonProps = {\n    initial: { text: \"Load Model\", action: load },\n    loadingModel: { text: \"Loading Model…\", action: () => {} },\n    modelReady: {\n      text: \"Upload Image\",\n      action: () => inputRef.current.click()\n    },\n    imageReady: { text: \"Identify Image\", action: () => identify },\n    identifying: { text: \"Identifying…\", action: () => {} },\n    complete: { text: \"Reset\", action: reset }\n  };\n\n  return (\n    <div>\n      {showImage && <img src={imageUrl} alt=\"upload-preview\" ref={imageRef} />}\n      <input\n        type=\"file\"\n        accept=\"image/*\"\n        capture=\"camera\"\n        ref={inputRef}\n        onChange={handleUpload}\n      ></input>\n      <button onClick={buttonProps[appState].action}>\n        {buttonProps[appState].text}\n      </button>\n      {showResults && <ul>{results.map(formatResult)}</ul>}\n    </div>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}